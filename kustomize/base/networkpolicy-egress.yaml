apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ssslite-networkpolicy-egress-allow
spec:
  # Match deployment pods.
  podSelector:
    matchLabels:
      app: ssslite-deployment
  # Egress policy only.
  policyTypes:
    - Egress
  # Allow rules:
  egress:
    # Allow access to cluster DNS.
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
          podSelector:
            matchLabels:
              k8s-app: kube-dns
    # Allow HTTPS & DNS requests to the internet.
    - to:
        - ipBlock:
            cidr: '0.0.0.0/0'
            # Exclude cluster-local IP ranges.
            except:
              - '10.0.0.0/8'
              - '172.16.0.0/12'
              - '192.168.0.0/16'
      ports:
        - port: 443
          protocol: TCP
        - port: 53
          protocol: UDP
